"use strict";(self.webpackChunkmyapp=self.webpackChunkmyapp||[]).push([[848],{848:(e,t,s)=>{s.r(t),s.d(t,{default:()=>b});var a=s(9379),n=s(5043),r=(s(9840),s(7281)),i=s(4030),l=s(9981),c=s(3862),d=s(579);const o=["open","contacted","not contacted","closed"],h=["interested","not interested","deal","not qualified","not received"],u={name:"",status:"All",remark:"",stateId:"",stateName:"",city:"",startDate:"",endDate:""},m=e=>{let{filters:t,onChange:s}=e;const[r,i]=(0,n.useState)([]),[m,x]=(0,n.useState)([]),[j]=(0,l.ok)();(0,n.useEffect)(()=>{const e=j.get("remark");e&&h.includes(e)&&!t.remark&&s((0,a.A)((0,a.A)({},t),{},{remark:e}))},[j,t,s]),(0,n.useEffect)(()=>{fetch((0,c.e)("get-indian-states.php")).then(e=>e.json()).then(e=>i(e)).catch(e=>console.error("State load error:",e))},[]),(0,n.useEffect)(()=>{t.stateId?fetch((0,c.e)("get-cities.php?state_id=".concat(t.stateId))).then(e=>e.json()).then(e=>x(e)).catch(e=>console.error("City load error:",e)):x([])},[t.stateId]);const p=e=>{const{name:n,value:i}=e.target;if("stateId"===n){const e=r.find(e=>String(e.id)===i);s((0,a.A)((0,a.A)({},t),{},{stateId:i,stateName:(null===e||void 0===e?void 0:e.name)||"",city:""}))}else s((0,a.A)((0,a.A)({},t),{},{[n]:i}))};return(0,d.jsxs)("div",{className:"filter-bar",children:[(0,d.jsx)("input",{type:"text",name:"name",value:t.name,placeholder:"Search by name",onChange:p}),(0,d.jsxs)("select",{name:"status",value:t.status,onChange:p,children:[(0,d.jsx)("option",{value:"All",children:"All Status"}),o.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]}),(0,d.jsxs)("select",{name:"remark",value:t.remark,onChange:p,children:[(0,d.jsx)("option",{value:"",children:"All Remarks"}),h.map(e=>(0,d.jsx)("option",{value:e,children:e},e))]}),(0,d.jsxs)("select",{name:"stateId",value:t.stateId,onChange:p,children:[(0,d.jsx)("option",{value:"",children:"All States"}),r.map(e=>(0,d.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,d.jsxs)("select",{name:"city",value:t.city,onChange:p,children:[(0,d.jsx)("option",{value:"",children:"All Cities"}),m.map(e=>(0,d.jsx)("option",{value:e.name,children:e.name},e.id))]}),(0,d.jsx)("input",{type:t.startDate?"date":"text",name:"startDate",value:t.startDate,placeholder:"Select Start Date",onFocus:e=>e.target.type="date",onBlur:e=>{t.startDate||(e.target.type="text")},onChange:p}),(0,d.jsx)("input",{type:t.endDate?"date":"text",name:"endDate",value:t.endDate,placeholder:"Select End Date",onFocus:e=>e.target.type="date",onBlur:e=>{t.endDate||(e.target.type="text")},onChange:p}),(0,d.jsx)("button",{className:"reset-btn",onClick:()=>{s((0,a.A)({},u))},children:"Reset Filters"})]})};var x=s(184);const j=e=>{let{inquiry:t,onClose:s}=e;return(0,d.jsx)("div",{className:"modal-backdrop",children:(0,d.jsxs)("div",{className:"modal-content",children:[(0,d.jsx)("button",{className:"modal-close",onClick:s,children:"\xd7"}),(0,d.jsx)("h3",{children:"Inquiry Details"}),(0,d.jsxs)("div",{className:"modal-info-grid",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)(x.x$1,{})," ",(0,d.jsx)("strong",{children:"Name:"})," ",t.name]}),(0,d.jsxs)("p",{children:[(0,d.jsx)(x.maD,{})," ",(0,d.jsx)("strong",{children:"Email:"})," ",t.email]}),(0,d.jsxs)("p",{children:[(0,d.jsx)(x.ZYm,{})," ",(0,d.jsx)("strong",{children:"State:"})," ",t.state]}),(0,d.jsxs)("p",{children:[(0,d.jsx)(x.zsO,{})," ",(0,d.jsx)("strong",{children:"City:"})," ",t.city]}),(0,d.jsxs)("p",{children:[(0,d.jsx)(x.hYw,{})," ",(0,d.jsx)("strong",{children:"Message:"})," ",t.message]}),t.remark&&(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Remark:"})," ",t.remark]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Status:"})," ",t.status]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Inquiry Date:"})," ",t.date]}),t.updated_at&&(0,d.jsxs)("p",{children:[(0,d.jsx)(x.w_X,{})," ",(0,d.jsx)("strong",{children:"Last Updated:"})," ",t.updated_at]})]})]})})},p=["open","contacted","not contacted","closed"],g=["interested","not interested","deal","not qualified","not received"],b=e=>{let{openLoginModal:t}=e;const[s,o]=(0,n.useState)(null),[h,u]=(0,n.useState)(null),[b,v]=(0,n.useState)([]),[y,N]=(0,n.useState)(null),[f,S]=(0,n.useState)(""),[k,C]=(0,n.useState)(""),[D,_]=(0,n.useState)(""),[A,w]=(0,n.useState)({}),[q,I]=(0,n.useState)([]),[E,F]=(0,n.useState)({name:"",status:"All",remark:"",startDate:"",endDate:""}),[O,L]=(0,n.useState)(null),P=(0,l.Zp)();(0,n.useEffect)(()=>{const e=localStorage.getItem("userSession");if(e){const t=JSON.parse(e);"brand"===t.user_type?o(t.id):P("/")}else P("/")},[P]);(0,n.useEffect)(()=>{if(!s)return;(async()=>{try{const e=await fetch((0,c.e)("check_brand_premium.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({brand_id:s})}),t=await e.json();u(t.success&&t.is_premium)}catch(e){console.error("Failed to check premium status",e),u(!1)}})()},[s]),(0,n.useEffect)(()=>{s&&!0===h&&fetch((0,c.e)("get_inquiries_by_brand.php?brand_id=".concat(s))).then(e=>e.json()).then(e=>I(e)).catch(e=>console.error("Failed to load inquiries",e))},[s,h]);const T=q.filter(e=>{const t=e.name.toLowerCase().includes(E.name.toLowerCase()),s="All"===E.status||e.status===E.status,a=!E.remark||e.remark===E.remark,n=!E.stateName||e.state===E.stateName,r=!E.city||e.city===E.city,i=new Date(e.date),l=E.startDate?new Date(E.startDate):null,c=E.endDate?new Date(E.endDate):null;return t&&s&&a&&n&&r&&((!l||i>=l)&&(!c||i<=c))});return null!==h&&s?!1===h?(0,d.jsxs)("div",{className:"brand-crm-container",children:[(0,d.jsx)(r.A,{openLoginModal:t}),(0,d.jsxs)("div",{className:"brand-crm-main",children:[(0,d.jsx)(i.A,{}),(0,d.jsxs)("div",{className:"upgrade-box",children:[(0,d.jsx)("h2",{children:"Upgrade to Premium"}),(0,d.jsx)("p",{children:"This feature is available only for premium brands. Please contact support to upgrade your plan."})]})]})]}):(0,d.jsxs)("div",{className:"brand-crm-container",children:[(0,d.jsx)(r.A,{openLoginModal:t}),(0,d.jsxs)("div",{className:"brand-crm-main",children:[(0,d.jsx)(i.A,{}),(0,d.jsxs)("div",{className:"inquiries-section",children:[(0,d.jsx)("h2",{children:"Franchise Inquiries"}),(0,d.jsx)(m,{filters:E,onChange:F}),(0,d.jsxs)("table",{className:"inquiries-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"#"}),(0,d.jsx)("th",{children:"Name"}),(0,d.jsx)("th",{children:"Contact"}),(0,d.jsx)("th",{children:"Status"}),(0,d.jsx)("th",{children:"Remark"}),(0,d.jsx)("th",{children:"State"}),(0,d.jsx)("th",{children:"Enquiry Date"}),(0,d.jsx)("th",{children:"Whatsapp"}),(0,d.jsx)("th",{children:"Actions"})]})}),(0,d.jsx)("tbody",{children:T.map((e,t)=>(0,d.jsxs)("tr",{className:"inquiry-row",children:[(0,d.jsx)("td",{children:t+1}),(0,d.jsx)("td",{children:e.name}),(0,d.jsx)("td",{children:b.includes(e.id)?(0,d.jsxs)(d.Fragment,{children:["\ud83d\udcde ",e.phone," ",(0,d.jsx)("br",{})," \u2709\ufe0f ",e.email]}):(0,d.jsxs)("button",{className:"icon-btn green",onClick:()=>{return t=e.id,void(b.includes(t)||(v(e=>[...e,t]),fetch((0,c.e)("log-view-contact.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inquiry_id:t,brand_id:s,description:"viewed contact details"})})));var t},children:[(0,d.jsx)(x.dRU,{className:"icon"}),(0,d.jsx)("span",{className:"btn-label",children:"Show"})]})}),(0,d.jsx)("td",{children:y===e.id?(0,d.jsx)("select",{value:f,onChange:e=>S(e.target.value),children:p.map(e=>(0,d.jsx)("option",{value:e,children:e},e))}):(0,d.jsx)("span",{className:"status-badge ".concat(e.status.replace(/\s+/g,"").toLowerCase()),children:e.status})}),(0,d.jsx)("td",{children:y===e.id?(0,d.jsx)("select",{value:k,onChange:e=>C(e.target.value),children:g.map(e=>(0,d.jsx)("option",{value:e,children:e},e))}):(0,d.jsx)("span",{children:e.remark})}),(0,d.jsx)("td",{children:e.state}),(0,d.jsx)("td",{children:e.date}),(0,d.jsx)("td",{children:e.updated_at?(0,d.jsx)(x.EcP,{className:"wa-icon",style:{color:"#25D366",cursor:"pointer",marginLeft:"6px",fontSize:"20px"},onClick:()=>(e=>{fetch((0,c.e)("log-view-contact.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inquiry_id:e.id,brand_id:s,description:"clicked WhatsApp link"})}).catch(e=>console.error("Failed to log WhatsApp click",e));const t=e.phone.replace(/\D/g,"");window.open("https://wa.me/91".concat(t),"_blank")})(e),title:"Chat on WhatsApp"}):"-"}),(0,d.jsx)("td",{children:(0,d.jsx)("div",{className:"icon-action-group",children:y===e.id?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("input",{type:"text",placeholder:"Enter comment",value:D,onChange:e=>_(e.target.value),style:{width:"100%",marginBottom:"4px"}}),A.comment&&(0,d.jsx)("div",{className:"error-text",children:A.comment}),(0,d.jsxs)("button",{className:"icon-only-btn icon-save",onClick:()=>(async e=>{if(D.trim())try{const t=await fetch((0,c.e)("update_inquiry_status.php"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,status:f,remark:k,comment:D})}),s=await t.json();if(s.success){const t=q.map(t=>t.id===e?(0,a.A)((0,a.A)({},t),{},{status:f,remark:k,comment:D,updated_at:s.updated_at}):t);I(t),N(null),_(""),w({})}else alert("Failed to save changes.")}catch(t){console.error("Save failed",t)}else w({comment:"Comment is required"})})(e.id),children:[(0,d.jsx)(x.dIn,{}),(0,d.jsx)("span",{className:"icon-label",children:"Save"})]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{className:"icon-only-btn icon-edit",onClick:()=>(e=>{N(e.id),S(e.status),C(e.remark||""),_(""),w({})})(e),children:[(0,d.jsx)(x.uO9,{}),(0,d.jsx)("span",{className:"icon-label",children:"Edit"})]}),(0,d.jsxs)("button",{className:"icon-only-btn icon-detail",onClick:()=>L(e),children:[(0,d.jsx)(x.Ny1,{}),(0,d.jsx)("span",{className:"icon-label",children:"Details"})]})]})})})]},e.id))})]})]})]}),O&&(0,d.jsx)(j,{inquiry:O,onClose:()=>L(null)})]}):(0,d.jsx)("div",{className:"brand-crm-container",children:(0,d.jsx)("p",{children:"Loading..."})})}},4030:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(5043),n=(s(9840),s(9981)),r=s(579);const i=()=>{const[e,t]=(0,a.useState)("Brand"),s=(0,n.Zp)();return(0,a.useEffect)(()=>{try{const e=localStorage.getItem("userSession");if(e){const s=JSON.parse(e);t(s.name||"Brand")}else s("/")}catch(e){console.error("Failed to retrieve or parse user session:",e)}},[]),(0,r.jsx)("header",{className:"brand-header",children:(0,r.jsxs)("h1",{children:["Welcome, ",e,"!"]})})}},7281:(e,t,s)=>{s.d(t,{A:()=>l});var a=s(5043),n=(s(9840),s(9981)),r=s(184),i=s(579);const l=()=>{const[e,t]=(0,a.useState)(!0);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"brand-sidebar ".concat(e?"open":"collapsed"),children:[(0,i.jsxs)("div",{className:"sidebar-header",children:[e?"Brand CRM":"",(0,i.jsx)("button",{className:"toggle-btn",onClick:()=>{t(!e)},children:e?(0,i.jsx)(r.QCr,{}):(0,i.jsx)(r.OXb,{})})]}),(0,i.jsxs)("ul",{className:"sidebar-menu",children:[(0,i.jsx)("li",{children:(0,i.jsxs)(n.N_,{to:"/brand/dashboard",children:["\ud83c\udfe0 ",e&&"Dashboard"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)(n.N_,{to:"/brand/inquiries",children:["\ud83d\udce8 ",e&&"Inquiries"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)(n.N_,{to:"/brand/upload-docs",children:["\ud83d\udcc1 ",e&&"Upload Docs"]})}),(0,i.jsx)("div",{className:"sidebar-divider"})," ",(0,i.jsx)("li",{children:(0,i.jsxs)(n.N_,{to:"/brand/profile",children:["\ud83d\udc64 ",e&&"Profile"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)(n.N_,{to:"/pricing",children:["\ud83d\udcbc ",e&&"Pricing"]})}),(0,i.jsx)("li",{children:(0,i.jsxs)("a",{href:"#",onClick:()=>{localStorage.clear(),window.location.href="/"},children:["\ud83d\udeaa ",e&&"Logout"]})})]})]})})}},9840:()=>{}}]);
//# sourceMappingURL=848.64ef3ad8.chunk.js.map